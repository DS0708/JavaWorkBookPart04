# 4.2 MyBatis와 스프링 연동

- 스프링 프레임워크의 중요한 특징 중 하나는 다른 프레임워크와 쉽게 결합해서 사용할 수 있다는 것이다.
- 이러한 특징 덕분에 스프링은 객체지향 설계 원칙을 기반으로 한 시스템의 아키텍처를 유연하게 만드는 데 적합하다.
- 데이터베이스와 관련해서 스프링 프레임워크는 자체적으로 'spring-jdbc'와 같은 라이브러리를 이용하기도 하지만, MyBatis나
JPA 프레임워크를 이용하는 방식도 존재한다.
- 4.2에서는 JDBC를 익힌 후 가장 쉽게 사용할 수 있는 MyBatis를 이용해 프로젝트에 적용해보겠다.


## MyBatis 소개
- MyBatis는 'Sql Mapping Framework'라고 표현되며 'Sql Mapping'이라는 단어가 의미하는 
바는 `SQL의 실행 결과를 객체지향으로 '매핑'해 준다는 뜻`이다.
- MyBatis를 이용하면 기존의 SQL을 그대로 사용할 수 있고 다음과 같은 점들이 편리해진다.
  1. PreparedStatement/ResultSet의 처리 - 하나씩 처리해야 하는 파라미터나 ResultSet의 
  getXXX()를 MyBatis가 알아서 처리해줘서 기존에 비해 많은 양의 코드를 줄일 수 있다.
  2. Connection/PreparedStatement/ResultSet의 close() 처리 - MyBaits와 스프링을 연동해서
  사용하는 방식을 이용하면 자동으로 close() 처리가 가능하다.
  3. SQL의 분리 - MyBats를 이용하면 별도의 파일이나 어노테이션 등을 이용해 SQL을 선언한다. 파일을 이용하는 경우에는
  SQL을 별도의 파일로 분리해서 운영 가능하다.


## MyBatis와 스프링의 연동 방식
- MyBatis는 단독으로 실행이 가능한 완전히 독립적인 프레임워크지만, 스프링 프레임워크는 MyBatis와 연동을 쉽게
처리할 수 있는 라이브러리와 API들을 제공한다.
- 스프링에서 제공하는 라이브러리를 이용하는지 여부에 따라 2가지 방식 중 하나로 개발이 가능하다.
  1. `MyBatis를 단독으로 개발하고 스프링에서 DAO를 작성해서 처리하는 방식` : 기존의 DAO에서 SQL의 처리를 
  MyBatis를 이용하는 구조로써 완전히 MyBatis와 스프링을 독립적인 존재로 바라보고 개발하는 방식
  2. `MyBatis와 스프링을 연동하고 Mapper 인터페이스만 이용하는 방식` : 스프링과 MyBatis 사이에 'mybatis-spring'
  이라는 라이브러리를 이용해 스프링이 DB 전체에 대한 처리를 하고 MyBatis는 일부 기능 개발에 활용하는 방식이다. 개발
  시에는 Mapper 인터페이스라는 방식을 이용해 인터페이스만으로 모든 개발이 가능한 방식
- 4.2에서는 최소한의 코드로 개발이 가능하며 스프링에서 제공하는 라이브러리인 'mybatis-spring'을 같이 연동해서
Mapper 인터페이스를 이용하는 방식으로 개발할 것이다.

### MyBatis를 위한 라이브러리들
- 스프링관련 : spring-jdbc, spring-tx
- MyBatis관련 : mybatis, mybatis-spring
  ```groovy
  dependencies {
    compileOnly('javax.servlet:javax.servlet-api:4.0.1')
  
    testImplementation("org.junit.jupiter:junit-jupiter-api:${junitVersion}")
    testRuntimeOnly("org.junit.jupiter:junit-jupiter-engine:${junitVersion}")
  
    //Spring
    implementation group: 'org.springframework', name: 'spring-core', version: '5.3.19'
    implementation group: 'org.springframework', name: 'spring-context', version: '5.3.19'
    implementation group: 'org.springframework', name: 'spring-test', version: '5.3.19'
    implementation group: 'org.springframework', name: 'spring-webmvc', version: '5.3.19'
    implementation group: 'org.springframework', name: 'spring-jdbc', version: '5.3.19'
    implementation group: 'org.springframework', name: 'spring-tx', version: '5.3.19'
  
    ...생략...
  
    //MyBatis
    implementation 'org.mybatis:mybatis:3.5.9'
    implementation 'org.mybatis:mybatis-spring:2.0.7'
  
  }
  ```
  - 스프링 관련 라이브러리는 프로젝트의 다른 스프링 관련 라이브러리들과 버전을 같도록 한다.
  - MyBatis 관련 라이브러리는 MVN Repository 검색을 이용해서 추가하도록 하며 MyBatis 버전과 
  mybatis-spring 라이브러리의 버전은 일치하지 않으므로 주의해서 사용한다.

### MyBatis를 위한 스프링의 설정 - SqlSessionFactory
- MyBatis를 이용하기 위해서는 스프링에 설정해둔 HikariDataSource를 이용해 SqlSessionFactory라는 Bean을
설정한다.
- root-context.xml에 'mybatis-spring' 라이브러리에 있는 클래스를 이용해 Bean을 등록한다.
  ```xml
  <bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean">
          <property name="dataSource" ref="dataSource"/>
      </bean>
  ```
- 앞의 설정이 완료된 상황에서 프로젝트 실행 시 정상적으로 동작해야 한다. (만일 spring-jdbc, spring-tx가 없는
경우 에러가 발생)


## 실습01 - Mapper 인터페이스 활용하기
## 실습02 - XML로 SQL 분리하기